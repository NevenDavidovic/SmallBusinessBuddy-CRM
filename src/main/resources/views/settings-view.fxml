<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.Slider?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.web.WebView?>
<?import javafx.collections.FXCollections?>

<BorderPane xmlns="http://javafx.com/javafx/11.0.1" xmlns:fx="http://javafx.com/fxml/1" fx:controller="smallbusinessbuddycrm.controllers.utilities.GoogleOAuthController" style="-fx-background-color: #f8fafe;">
    <center>
        <ScrollPane fitToWidth="true" hbarPolicy="NEVER" vbarPolicy="AS_NEEDED" style="-fx-background-color: transparent; -fx-background: transparent;">
            <content>
                <VBox fx:id="mainContent" spacing="24.0" style="-fx-background-color: transparent;">
                    <padding>
                        <Insets bottom="32.0" left="32.0" right="32.0" top="32.0" />
                    </padding>
                    <children>
                        <!-- Modern Header -->
                        <VBox spacing="16.0" style="-fx-alignment: center; -fx-padding: 0 0 24 0;">
                            <children>
                                <Label fx:id="headerTitle" style="-fx-font-size: 32px; -fx-font-weight: 700; -fx-text-fill: #1a1d29;" text="Settings" />
                                <Label fx:id="headerSubtitle" style="-fx-font-size: 16px; -fx-text-fill: #6b7280; -fx-font-weight: 400;" text="Configure your account and preferences" />
                            </children>
                        </VBox>

                        <!-- Language Settings Card -->
                        <VBox spacing="20.0" style="-fx-background-color: white; -fx-padding: 24; -fx-background-radius: 12; -fx-border-radius: 12; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.04), 8, 0, 0, 2);">
                            <children>
                                <!-- Section Header -->
                                <VBox spacing="8.0">
                                    <children>
                                        <Label fx:id="languageTitle" style="-fx-font-size: 18px; -fx-font-weight: 600; -fx-text-fill: #111827;" text="Language / Jezik" />
                                        <Label fx:id="languageDescription" style="-fx-font-size: 14px; -fx-text-fill: #6b7280;" text="Choose your preferred language / Odaberite željeni jezik" />
                                    </children>
                                </VBox>

                                <!-- Language Buttons -->
                                <HBox spacing="12.0">
                                    <children>
                                        <Button fx:id="englishButton" mnemonicParsing="false" onAction="#switchToEnglish" prefHeight="44.0" style="-fx-background-color: #3b82f6; -fx-text-fill: white; -fx-font-size: 14px; -fx-font-weight: 600; -fx-background-radius: 8; -fx-border-radius: 8; -fx-cursor: hand; -fx-effect: dropshadow(gaussian, rgba(59,130,246,0.25), 4, 0, 0, 2);" text="English" />
                                        <Button fx:id="croatianButton" mnemonicParsing="false" onAction="#switchToCroatian" prefHeight="44.0" style="-fx-background-color: #6b7280; -fx-text-fill: white; -fx-font-size: 14px; -fx-font-weight: 600; -fx-background-radius: 8; -fx-border-radius: 8; -fx-cursor: hand;" text="Hrvatski" />
                                    </children>
                                </HBox>

                                <!-- Current Language Indicator -->
                                <HBox spacing="8.0" style="-fx-background-color: #f9fafb; -fx-padding: 12; -fx-background-radius: 6; -fx-border-radius: 6; -fx-alignment: center-left;">
                                    <children>
                                        <Label style="-fx-font-size: 14px; -fx-font-weight: 500; -fx-text-fill: #374151;" text="✓" />
                                        <Label fx:id="currentLanguageLabel" style="-fx-font-size: 14px; -fx-text-fill: #374151;" text="Current language: English" />
                                    </children>
                                </HBox>
                            </children>
                        </VBox>

                        <!-- Google Account Card -->
                        <VBox spacing="24.0" style="-fx-background-color: white; -fx-padding: 24; -fx-background-radius: 12; -fx-border-radius: 12; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.04), 8, 0, 0, 2);">
                            <children>
                                <!-- Section Header -->
                                <HBox spacing="12.0" style="-fx-alignment: center-left;">
                                    <children>
                                        <VBox fx:id="statusIndicator" prefHeight="12.0" prefWidth="12.0" style="-fx-background-color: #ef4444; -fx-background-radius: 6; -fx-effect: dropshadow(gaussian, rgba(239,68,68,0.4), 4, 0, 0, 0);" />
                                        <Label fx:id="googleAccountTitle" style="-fx-font-size: 18px; -fx-font-weight: 600; -fx-text-fill: #111827;" text="Google Account" />
                                    </children>
                                </HBox>

                                <Label fx:id="statusText" style="-fx-font-size: 14px; -fx-text-fill: #6b7280;" text="Not connected" />
                                <Label fx:id="statusLabel" style="-fx-font-size: 14px; -fx-text-fill: #374151; -fx-wrap-text: true;" text="Connect your Google account to enable Gmail integration" />
                            </children>
                        </VBox>

                        <!-- Sign In Section -->
                        <VBox fx:id="signInSection" spacing="24.0">
                            <children>
                                <!-- Connection Card -->
                                <VBox spacing="20.0" style="-fx-background-color: white; -fx-padding: 24; -fx-background-radius: 12; -fx-border-radius: 12; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.04), 8, 0, 0, 2);">
                                    <children>
                                        <!-- Header -->
                                        <VBox spacing="8.0">
                                            <children>
                                                <Label fx:id="connectAccountTitle" style="-fx-font-size: 18px; -fx-font-weight: 600; -fx-text-fill: #111827;" text="Connect Account" />
                                                <Label fx:id="connectAccountDescription" style="-fx-font-size: 14px; -fx-text-fill: #6b7280; -fx-wrap-text: true;" text="Securely connect your Google account using OAuth 2.0" />
                                            </children>
                                        </VBox>

                                        <!-- Features List -->
                                        <VBox spacing="12.0" style="-fx-background-color: #f9fafb; -fx-padding: 16; -fx-background-radius: 8; -fx-border-radius: 8;">
                                            <children>
                                                <HBox spacing="12.0" style="-fx-alignment: center-left;">
                                                    <children>
                                                        <Label style="-fx-font-size: 16px;" text="✓" />
                                                        <Label fx:id="feature1Label" style="-fx-font-size: 14px; -fx-text-fill: #374151;" text="Send emails directly from Gmail" />
                                                    </children>
                                                </HBox>
                                                <HBox spacing="12.0" style="-fx-alignment: center-left;">
                                                    <children>
                                                        <Label style="-fx-font-size: 16px;" text="✓" />
                                                        <Label fx:id="feature2Label" style="-fx-font-size: 14px; -fx-text-fill: #374151;" text="Secure OAuth 2.0 authentication" />
                                                    </children>
                                                </HBox>
                                                <HBox spacing="12.0" style="-fx-alignment: center-left;">
                                                    <children>
                                                        <Label style="-fx-font-size: 16px;" text="✓" />
                                                        <Label fx:id="feature3Label" style="-fx-font-size: 14px; -fx-text-fill: #374151;" text="Automatic token refresh" />
                                                    </children>
                                                </HBox>
                                            </children>
                                        </VBox>

                                        <!-- Connect Button -->
                                        <Button fx:id="signInButton" mnemonicParsing="false" onAction="#handleSignIn" prefHeight="44.0" style="-fx-background-color: #3b82f6; -fx-text-fill: white; -fx-font-size: 14px; -fx-font-weight: 600; -fx-background-radius: 8; -fx-border-radius: 8; -fx-cursor: hand; -fx-effect: dropshadow(gaussian, rgba(59,130,246,0.25), 4, 0, 0, 2);" text="Connect Google Account" />

                                        <!-- Dev Tools -->
                                        <VBox spacing="12.0" style="-fx-background-color: #fef3c7; -fx-padding: 16; -fx-background-radius: 8; -fx-border-radius: 8;">
                                            <children>
                                                <Label fx:id="devToolsTitle" style="-fx-font-size: 14px; -fx-font-weight: 600; -fx-text-fill: #92400e;" text="Development Tools" />
                                                <HBox spacing="8.0">
                                                    <children>
                                                        <Button fx:id="demoModeButton" mnemonicParsing="false" onAction="#handleTestDemoMode" style="-fx-background-color: #f59e0b; -fx-text-fill: white; -fx-font-size: 12px; -fx-background-radius: 6; -fx-border-radius: 6; -fx-padding: 6 12 6 12; -fx-cursor: hand;" text="Demo Mode" />
                                                        <Button fx:id="testServerButton" mnemonicParsing="false" onAction="#testCallback" style="-fx-background-color: #8b5cf6; -fx-text-fill: white; -fx-font-size: 12px; -fx-background-radius: 6; -fx-border-radius: 6; -fx-padding: 6 12 6 12; -fx-cursor: hand;" text="Test Server" />
                                                        <Button fx:id="debugButton" mnemonicParsing="false" onAction="#debugConnectionState" style="-fx-background-color: #ef4444; -fx-text-fill: white; -fx-font-size: 12px; -fx-background-radius: 6; -fx-border-radius: 6; -fx-padding: 6 12 6 12; -fx-cursor: hand;" text="Debug" />
                                                        <Button fx:id="userInfoButton" mnemonicParsing="false" onAction="#forceGetUserInfo" style="-fx-background-color: #06b6d4; -fx-text-fill: white; -fx-font-size: 12px; -fx-background-radius: 6; -fx-border-radius: 6; -fx-padding: 6 12 6 12; -fx-cursor: hand;" text="User Info" />
                                                    </children>
                                                </HBox>
                                            </children>
                                        </VBox>
                                    </children>
                                </VBox>
                            </children>
                        </VBox>

                        <!-- Connected Account Section -->
                        <VBox fx:id="connectedSection" spacing="24.0" visible="false">
                            <children>
                                <!-- Success Card -->
                                <VBox spacing="20.0" style="-fx-background-color: #f0fdf4; -fx-padding: 24; -fx-background-radius: 12; -fx-border-radius: 12; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.04), 8, 0, 0, 2);">
                                    <children>
                                        <!-- Success Header -->
                                        <VBox spacing="8.0">
                                            <children>
                                                <Label fx:id="connectedSuccessTitle" style="-fx-font-size: 18px; -fx-font-weight: 600; -fx-text-fill: #15803d;" text="✓ Connected Successfully" />
                                                <Label fx:id="connectedEmailLabel" style="-fx-font-size: 14px; -fx-text-fill: #166534;" text="Connected as: user@gmail.com" />
                                                <Label fx:id="connectedNameLabel" style="-fx-font-size: 14px; -fx-text-fill: #166534;" text="User Name" />
                                            </children>
                                        </VBox>

                                        <!-- Action Buttons -->
                                        <HBox spacing="12.0">
                                            <children>
                                                <Button fx:id="sendTestEmailButton" mnemonicParsing="false" onAction="#handleSendTestEmail" prefHeight="36.0" style="-fx-background-color: #10b981; -fx-text-fill: white; -fx-font-size: 13px; -fx-font-weight: 600; -fx-background-radius: 6; -fx-border-radius: 6; -fx-cursor: hand;" text="Send Test Email" />
                                                <Button fx:id="quickTestButton" mnemonicParsing="false" onAction="#handleQuickTestEmail" prefHeight="36.0" style="-fx-background-color: #06b6d4; -fx-text-fill: white; -fx-font-size: 13px; -fx-font-weight: 600; -fx-background-radius: 6; -fx-border-radius: 6; -fx-cursor: hand;" text="Quick Test" />
                                                <Button fx:id="signOutButton" mnemonicParsing="false" onAction="#handleSignOut" prefHeight="36.0" style="-fx-background-color: #ef4444; -fx-text-fill: white; -fx-font-size: 13px; -fx-font-weight: 600; -fx-background-radius: 6; -fx-border-radius: 6; -fx-cursor: hand;" text="Sign Out" />
                                            </children>
                                        </HBox>

                                        <!-- Connection Info -->
                                        <HBox spacing="16.0" style="-fx-background-color: #dcfce7; -fx-padding: 12; -fx-background-radius: 6; -fx-border-radius: 6;">
                                            <children>
                                                <VBox spacing="4.0" style="-fx-alignment: center;">
                                                    <children>
                                                        <Label fx:id="oauth20Label" style="-fx-font-size: 12px; -fx-font-weight: 600; -fx-text-fill: #166534;" text="OAuth 2.0" />
                                                        <Label fx:id="authenticatedLabel" style="-fx-font-size: 10px; -fx-text-fill: #166534;" text="Authenticated" />
                                                    </children>
                                                </VBox>
                                                <VBox spacing="4.0" style="-fx-alignment: center;">
                                                    <children>
                                                        <Label fx:id="gmailApiLabel" style="-fx-font-size: 12px; -fx-font-weight: 600; -fx-text-fill: #166534;" text="Gmail API" />
                                                        <Label fx:id="readyLabel" style="-fx-font-size: 10px; -fx-text-fill: #166534;" text="Ready" />
                                                    </children>
                                                </VBox>
                                                <VBox spacing="4.0" style="-fx-alignment: center;">
                                                    <children>
                                                        <Label fx:id="autoRefreshLabel" style="-fx-font-size: 12px; -fx-font-weight: 600; -fx-text-fill: #166534;" text="Auto-Refresh" />
                                                        <Label fx:id="enabledLabel" style="-fx-font-size: 10px; -fx-text-fill: #166534;" text="Enabled" />
                                                    </children>
                                                </VBox>
                                            </children>
                                        </HBox>
                                    </children>
                                </VBox>
                            </children>
                        </VBox>

                        <!-- Contacts Column Settings Card -->
                        <VBox spacing="20.0" style="-fx-background-color: white; -fx-padding: 24; -fx-background-radius: 12; -fx-border-radius: 12; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.04), 8, 0, 0, 2);">
                            <children>
                                <!-- Section Header -->
                                <VBox spacing="8.0">
                                    <children>
                                        <Label fx:id="columnsTitle" style="-fx-font-size: 18px; -fx-font-weight: 600; -fx-text-fill: #111827;" text="Table Columns" />
                                        <Label fx:id="columnsDescription" style="-fx-font-size: 14px; -fx-text-fill: #6b7280;" text="Customize which columns are visible in the contacts table" />
                                    </children>
                                </VBox>

                                <!-- Current Status -->
                                <VBox fx:id="columnStatusContainer" spacing="16.0" style="-fx-background-color: #f9fafb; -fx-padding: 16; -fx-background-radius: 8; -fx-border-radius: 8;">
                                    <children>
                                        <!-- Status Header -->
                                        <HBox spacing="8.0" style="-fx-alignment: center-left;">
                                            <children>
                                                <Label fx:id="columnStatusLabel" style="-fx-font-size: 14px; -fx-font-weight: 500; -fx-text-fill: #374151;" text="Current Status" />
                                                <Label fx:id="columnCountLabel" style="-fx-font-size: 12px; -fx-text-fill: #059669; -fx-font-weight: 600; -fx-background-color: #d1fae5; -fx-padding: 2 8 2 8; -fx-background-radius: 12; -fx-border-radius: 12;" text="12 of 16 visible" />
                                            </children>
                                        </HBox>

                                        <!-- Visible Columns -->
                                        <VBox spacing="6.0">
                                            <children>
                                                <Label fx:id="visibleColumnsTitle" style="-fx-font-size: 12px; -fx-font-weight: 500; -fx-text-fill: #059669;" text="Visible columns:" />
                                                <Label fx:id="visibleColumnsLabel" style="-fx-font-size: 12px; -fx-text-fill: #065f46; -fx-wrap-text: true; -fx-padding: 8; -fx-background-color: #d1fae5; -fx-background-radius: 6; -fx-border-radius: 6;" text="First Name, Last Name, Birthday, Age, Email, Phone Number, Street Name, Postal Code, City, Member Status" />
                                            </children>
                                        </VBox>

                                        <!-- Hidden Columns -->
                                        <VBox fx:id="hiddenColumnsContainer" spacing="6.0">
                                            <children>
                                                <Label fx:id="hiddenColumnsTitle" style="-fx-font-size: 12px; -fx-font-weight: 500; -fx-text-fill: #dc2626;" text="Hidden columns:" />
                                                <Label fx:id="hiddenColumnsLabel" style="-fx-font-size: 12px; -fx-text-fill: #991b1b; -fx-wrap-text: true; -fx-padding: 8; -fx-background-color: #fee2e2; -fx-background-radius: 6; -fx-border-radius: 6;" text="PIN, Street Number, Member Since, Member Until, Created, Updated" />
                                            </children>
                                        </VBox>
                                    </children>
                                </VBox>

                                <!-- Action Buttons -->
                                <VBox spacing="12.0">
                                    <children>
                                        <Button fx:id="editColumnsButton" mnemonicParsing="false" onAction="#handleEditColumns" prefHeight="44.0" style="-fx-background-color: #3b82f6; -fx-text-fill: white; -fx-font-size: 14px; -fx-font-weight: 600; -fx-background-radius: 8; -fx-border-radius: 8; -fx-cursor: hand; -fx-effect: dropshadow(gaussian, rgba(59,130,246,0.25), 4, 0, 0, 2);" text="Edit Columns" />

                                        <HBox spacing="8.0">
                                            <children>
                                                <Button fx:id="resetColumnsButton" mnemonicParsing="false" onAction="#handleResetColumns" prefHeight="36.0" style="-fx-background-color: #6b7280; -fx-text-fill: white; -fx-font-size: 13px; -fx-font-weight: 500; -fx-background-radius: 6; -fx-border-radius: 6; -fx-cursor: hand;" text="Reset to Default" />
                                                <Button fx:id="showAllColumnsButton" mnemonicParsing="false" onAction="#handleShowAllColumns" prefHeight="36.0" style="-fx-background-color: #10b981; -fx-text-fill: white; -fx-font-size: 13px; -fx-font-weight: 500; -fx-background-radius: 6; -fx-border-radius: 6; -fx-cursor: hand;" text="Show All" />
                                            </children>
                                        </HBox>
                                    </children>
                                </VBox>

                                <Label fx:id="columnsChangeNote" style="-fx-font-size: 12px; -fx-text-fill: #9ca3af;" text="Changes apply immediately to the contacts table" />
                            </children>
                        </VBox>

                        <!-- Status Message -->
                        <Label fx:id="statusMessageLabel" style="-fx-font-size: 14px; -fx-text-fill: #6b7280; -fx-background-color: white; -fx-padding: 16; -fx-background-radius: 8; -fx-border-radius: 8; -fx-text-alignment: center; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.04), 8, 0, 0, 2);" text="Ready to connect..." wrapText="true" />

                        <!-- Bottom Spacing -->
                        <VBox prefHeight="24.0" />
                    </children>
                </VBox>
            </content>
        </ScrollPane>
    </center>

    <!-- OAuth WebView Overlay -->
    <fx:define>
        <VBox fx:id="oauthOverlay" style="-fx-background-color: rgba(0,0,0,0.5);" visible="false">
            <children>
                <VBox spacing="20.0" style="-fx-background-color: white; -fx-padding: 24; -fx-background-radius: 12; -fx-border-radius: 12; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.25), 20, 0, 0, 8);">
                    <VBox.margin>
                        <Insets bottom="40.0" left="40.0" right="40.0" top="40.0" />
                    </VBox.margin>
                    <children>
                        <!-- Overlay Header -->
                        <HBox spacing="16.0" style="-fx-alignment: center-left;">
                            <children>
                                <VBox spacing="4.0">
                                    <children>
                                        <Label fx:id="authenticationTitle" style="-fx-font-size: 18px; -fx-font-weight: 600; -fx-text-fill: #111827;" text="Google Authentication" />
                                        <Label fx:id="authenticationDescription" style="-fx-font-size: 14px; -fx-text-fill: #6b7280;" text="Complete the sign-in process below" />
                                    </children>
                                </VBox>
                                <Button fx:id="closeOAuthButton" mnemonicParsing="false" onAction="#handleCloseOAuth" style="-fx-background-color: #f3f4f6; -fx-text-fill: #6b7280; -fx-background-radius: 6; -fx-border-radius: 6; -fx-padding: 8 12 8 12; -fx-cursor: hand;" text="✕ Close" />
                            </children>
                        </HBox>

                        <WebView fx:id="oauthWebView" prefHeight="500.0" prefWidth="700.0" style="-fx-background-radius: 8; -fx-border-radius: 8;" />
                    </children>
                </VBox>
            </children>
        </VBox>
    </fx:define>
</BorderPane>